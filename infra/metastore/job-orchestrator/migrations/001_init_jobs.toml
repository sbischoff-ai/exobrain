# Create orchestrator job-state tracking table.

[[actions]]
type = "create_table"
name = "orchestrator_jobs"
primary_key = ["job_id"]

    [[actions.columns]]
    name = "job_id"
    type = "UUID"
    nullable = false

    [[actions.columns]]
    name = "job_type"
    type = "TEXT"
    nullable = false

    [[actions.columns]]
    name = "correlation_id"
    type = "TEXT"
    nullable = false

    [[actions.columns]]
    name = "payload"
    type = "JSONB"
    nullable = false

    [[actions.columns]]
    name = "attempt"
    type = "INTEGER"
    nullable = false
    default = "0"

    [[actions.columns]]
    name = "status"
    type = "TEXT"
    nullable = false

    [[actions.columns]]
    name = "last_error"
    type = "TEXT"

    [[actions.columns]]
    name = "created_at"
    type = "TIMESTAMPTZ"
    nullable = false
    default = "NOW()"

    [[actions.columns]]
    name = "updated_at"
    type = "TIMESTAMPTZ"
    nullable = false
    default = "NOW()"

    [[actions.columns]]
    name = "completed_at"
    type = "TIMESTAMPTZ"

[[actions]]
type = "add_index"
table = "orchestrator_jobs"

    [actions.index]
    name = "idx_orchestrator_jobs_status_created_at"
    columns = ["status", "created_at"]
