# Create orchestrator job-state tracking table.

[[actions]]
type = "sql"
up = """
CREATE TABLE IF NOT EXISTS orchestrator_jobs (
  job_id UUID PRIMARY KEY,
  job_type TEXT NOT NULL,
  correlation_id TEXT NOT NULL,
  payload JSONB NOT NULL,
  attempt INTEGER NOT NULL DEFAULT 0,
  status TEXT NOT NULL,
  last_error TEXT,
  created_at TIMESTAMPTZ NOT NULL DEFAULT NOW(),
  updated_at TIMESTAMPTZ NOT NULL DEFAULT NOW(),
  completed_at TIMESTAMPTZ
);

CREATE INDEX IF NOT EXISTS idx_orchestrator_jobs_status_created_at
  ON orchestrator_jobs (status, created_at DESC);
"""
down = """
DROP TABLE IF EXISTS orchestrator_jobs;
"""
